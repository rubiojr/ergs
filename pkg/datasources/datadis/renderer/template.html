<div class="block-datadis">
    {{$consumption := index .Metadata "consumption"}}
    {{$date := index .Metadata "date"}}
    {{$hour := index .Metadata "hour"}}
    {{$cups := index .Metadata "cups"}}
    {{$address := index .Metadata "address"}}
    {{$municipality := index .Metadata "municipality"}}
    {{$province := index .Metadata "province"}}
    {{$postalCode := index .Metadata "postal_code"}}
    {{$distributor := index .Metadata "distributor"}}
    {{$obtainMethod := index .Metadata "obtain_method"}}

    <div class="dd-header">
        <div class="dd-stats">
            {{if $consumption}}
            <div class="stat-value">{{printf "%.2f" $consumption}}</div>
            <div class="stat-unit">kWh</div>
            {{else}}
            <div class="stat-placeholder">‚ö°</div>
            {{end}}
        </div>

        <div class="dd-content">
            <div class="dd-title">
                <strong></strong>‚ö° Electricity Consumption</strong>
                {{if $date}}
                <span class="dd-date">{{$date}}</span>
                {{end}}
                {{if $hour}}
                <span class="dd-hour">at {{$hour}}:00</span>
                {{end}}
            </div>

            {{if $address}}
            <div class="dd-location">
                <span class="dd-location-icon">üìç</span>
                <span class="dd-address">{{$address}}</span>
                {{if and $municipality $province}}
                <span class="dd-location-details">
                    {{$municipality}}, {{$province}}
                    {{if $postalCode}}{{$postalCode}}{{end}}
                </span>
                {{end}}
            </div>
            {{end}}

            <div class="dd-meta">
                <span class="dd-time">{{formatTime .Block.CreatedAt}}</span>
                {{if $distributor}}
                <span class="dd-separator">|</span>
                <span class="dd-distributor">üè¢ {{$distributor}}</span>
                {{end}}
                {{if $obtainMethod}}
                <span class="dd-separator">|</span>
                <span class="dd-method">Method: {{$obtainMethod}}</span>
                {{end}}
            </div>
        </div>
    </div>

    {{if $cups}}
    <div class="dd-details">
        <details class="dd-details-element">
            <summary>Show CUPS details</summary>
            <div class="dd-details-content">
                <div class="dd-cups">
                    <strong>CUPS:</strong>
                    <code>{{$cups}}</code>
                </div>
            </div>
        </details>
    </div>
    {{end}}

    {{$excludes := slice "consumption" "date" "hour" "cups" "address" "municipality" "province" "postal_code" "distributor" "obtain_method" "source" "dstype"}}
    {{$filteredMetadata := filterMetadata .Metadata $excludes}}
    {{if $filteredMetadata}}
    <div class="dd-extras">
        <details class="dd-details-element">
            <summary>Show additional data</summary>
            <div class="dd-extras-content">
                <dl class="dd-metadata">
                    {{range $key, $value := $filteredMetadata}}
                    <dt>{{$key}}</dt>
                    <dd>{{$value}}</dd>
                    {{end}}
                </dl>
            </div>
        </details>
    </div>
    {{end}}
</div>

<style>
    /* Use existing global CSS variables for theme compatibility */
    .block-datadis {
        margin-bottom: 1.5rem;
        padding: 0;
        border: 1px solid var(--border);
        border-radius: 4px;
        background: var(--surface);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
        font-size: 13px;
        line-height: 1.3;
        transition: background 0.25s ease, border-color 0.25s ease;
    }

    .dd-header {
        display: flex;
        gap: 8px;
        padding: 6px 8px;
        background: var(--surface-alt);
        border-bottom: 1px solid var(--border);
    }

    .dd-stats {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 50px;
        padding-top: 2px;
        background: linear-gradient(135deg, var(--accent-soft) 0%, var(--surface) 100%);
        border-radius: 4px;
        padding: 8px;
    }

    .stat-value {
        font-size: 16px;
        font-weight: 700;
        color: var(--accent);
        line-height: 1;
        font-variant-numeric: tabular-nums;
    }

    .stat-unit {
        font-size: 9px;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        line-height: 1;
        margin-top: 2px;
        font-weight: 600;
    }

    .stat-placeholder {
        color: var(--text-faint);
        font-size: 20px;
    }

    .dd-content {
        flex: 1;
        min-width: 0;
    }

    .dd-title {
        margin-bottom: 6px;
        line-height: 1.2;
        font-size: 14px;
        color: var(--text);
        word-wrap: break-word;
        overflow-wrap: break-word;
    }

    .dd-title strong {
        color: var(--text);
    }

    .dd-date {
        color: var(--text);
        font-weight: 600;
        margin-left: 6px;
        font-variant-numeric: tabular-nums;
    }

    .dd-hour {
        color: var(--text-dim);
        font-weight: normal;
        margin-left: 4px;
        font-variant-numeric: tabular-nums;
    }

    .dd-location {
        margin: 4px 0;
        font-size: 12px;
        color: var(--text);
        line-height: 1.4;
    }

    .dd-location-icon {
        margin-right: 4px;
    }

    .dd-address {
        font-weight: 500;
        color: var(--text);
    }

    .dd-location-details {
        color: var(--text-dim);
        margin-left: 4px;
        font-size: 11px;
    }

    .dd-meta {
        color: var(--text-dim);
        font-size: 11px;
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
        margin-top: 4px;
    }

    .dd-time {
        font-variant-numeric: tabular-nums;
    }

    .dd-separator {
        color: var(--border-alt);
        margin: 0 2px;
    }

    .dd-distributor,
    .dd-method {
        font-weight: normal;
    }

    .dd-details,
    .dd-extras {
        background: var(--surface-alt);
        padding: 8px;
        border-top: 1px solid var(--border);
    }

    .dd-details-element {
        font-size: 12px;
    }

    .dd-details-element summary {
        color: var(--text-dim);
        cursor: pointer;
        padding: 4px 0;
        font-weight: normal;
        transition: color 0.2s ease;
    }

    .dd-details-element summary:hover {
        color: var(--text);
    }

    .dd-details-element[open] summary {
        margin-bottom: 8px;
        border-bottom: 1px solid var(--border-alt);
        padding-bottom: 8px;
    }

    .dd-details-content,
    .dd-extras-content {
        background: var(--surface);
        padding: 12px;
        border: 1px solid var(--border);
        border-radius: 2px;
        color: var(--text);
        font-size: 13px;
        line-height: 1.4;
    }

    .dd-cups {
        font-size: 12px;
    }

    .dd-cups code {
        background: var(--surface-alt);
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        font-size: 11px;
        color: var(--text);
        border: 1px solid var(--border);
        margin-left: 6px;
        display: inline-block;
        word-break: break-all;
    }

    .dd-metadata {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 4px 12px;
        margin: 0;
    }

    .dd-metadata dt {
        font-weight: 500;
        color: var(--text-dim);
        font-size: 12px;
    }

    .dd-metadata dd {
        margin: 0;
        color: var(--text);
        word-break: break-word;
        font-size: 12px;
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
        .dd-header {
            padding: 8px 6px;
        }
        .dd-stats {
            min-width: 45px;
            padding: 6px;
        }
        .stat-value {
            font-size: 14px;
        }
        .dd-meta {
            font-size: 10px;
        }
        .dd-location-details {
            display: block;
            margin-left: 20px;
            margin-top: 2px;
        }
    }

    /* Hover state */
    .dd-header:hover {
        background: var(--surface);
    }
</style>
