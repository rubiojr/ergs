<div class="block-codeberg">
    {{$eventType := index .Metadata "event_type"}} {{$actorLogin := index
    .Metadata "actor_login"}} {{$repoName := index .Metadata "repo_name"}}
    {{$repoURL := index .Metadata "repo_url"}} {{$stars := index .Metadata
    "stars"}} {{$forks := index .Metadata "forks"}} {{$language := index
    .Metadata "language"}} {{$public := index .Metadata "public"}}

    <div class="cb-header">
        <div class="cb-stats">
            {{if and $stars (gt $stars 0)}}
            <div class="stat-score">{{$stars}}</div>
            <div class="stat-label">stars</div>
            {{else}}
            <div class="stat-placeholder">ðŸŒ²</div>
            {{end}}
        </div>

        <div class="cb-content">
            <div class="cb-title">
                <strong>{{$actorLogin | default "unknown"}}</strong>
                {{$eventType | default "Event"}} {{if $repoName}} in {{if
                $repoURL}}
                <a href="{{$repoURL}}" target="_blank" class="cb-repo-link"
                    >{{$repoName}}</a
                >
                {{else}}
                <span class="cb-repo-name">{{$repoName}}</span>
                {{end}} {{end}} {{if $language}}
                <span class="cb-language">({{$language}})</span>
                {{end}}
            </div>

            {{if eq $eventType "PushEvent"}} {{$ref := index .Metadata "ref"}}
            {{$size := index .Metadata "size"}} {{if or $ref $size}}
            <div class="cb-event-details">
                {{if $ref}}<span class="cb-ref">{{$ref}}</span>{{end}} {{if
                $size}}{{if $ref}} â€¢ {{end}}{{$size}} commits{{end}}
            </div>
            {{end}} {{end}} {{if eq $eventType "IssuesEvent"}} {{$action :=
            index .Metadata "action"}} {{$issueNumber := index .Metadata
            "issue_number"}} {{$issueTitle := index .Metadata "issue_title"}}
            {{$issueURL := index .Metadata "issue_url"}} {{if and $action
            $issueNumber $issueTitle}}
            <div class="cb-event-details">
                <span class="cb-action cb-action-{{$action}}">{{$action}}</span>
                {{if $issueURL}}
                <a href="{{$issueURL}}" target="_blank" class="cb-issue-link">
                    #{{$issueNumber}}: {{if gt (len $issueTitle) 60}}{{slice
                    $issueTitle 0 60}}...{{else}}{{$issueTitle}}{{end}}
                </a>
                {{else}}
                <span class="cb-issue-ref"
                    >#{{$issueNumber}}: {{if gt (len $issueTitle) 60}}{{slice
                    $issueTitle 0 60}}...{{else}}{{$issueTitle}}{{end}}</span
                >
                {{end}}
            </div>
            {{end}} {{end}} {{if eq $eventType "PullRequestEvent"}} {{$action :=
            index .Metadata "action"}} {{$prNumber := index .Metadata
            "pr_number"}} {{$prTitle := index .Metadata "pr_title"}} {{$prURL :=
            index .Metadata "pr_url"}} {{if and $action $prNumber $prTitle}}
            <div class="cb-event-details">
                <span class="cb-action cb-action-{{$action}}">{{$action}}</span>
                {{if $prURL}}
                <a href="{{$prURL}}" target="_blank" class="cb-pr-link">
                    #{{$prNumber}}: {{if gt (len $prTitle) 60}}{{slice $prTitle
                    0 60}}...{{else}}{{$prTitle}}{{end}}
                </a>
                {{else}}
                <span class="cb-pr-ref"
                    >#{{$prNumber}}: {{if gt (len $prTitle) 60}}{{slice $prTitle
                    0 60}}...{{else}}{{$prTitle}}{{end}}</span
                >
                {{end}}
            </div>
            {{end}} {{end}}

            <div class="cb-meta">
                <span class="cb-time">{{formatTime .Block.CreatedAt}}</span>
                {{if and $forks (gt $forks 0)}}
                <span class="cb-separator">|</span>
                <span class="cb-forks">{{$forks}} forks</span>
                {{end}}
                <span class="cb-separator">|</span>
                <span class="cb-visibility"
                    >{{if $public}}public{{else}}private{{end}}</span
                >
                {{if $repoURL}}
                <span class="cb-separator">|</span>
                <a href="{{$repoURL}}" target="_blank" class="cb-view"
                    >view repo</a
                >
                {{end}}
            </div>
        </div>
    </div>

    {{$repoDesc := index .Metadata "repo_desc"}} {{if $repoDesc}}
    <div class="cb-description">
        <details class="cb-details">
            <summary>Show description</summary>
            <div class="cb-description-content">
                {{if gt (len $repoDesc) 300}}{{slice $repoDesc 0
                300}}...{{else}}{{$repoDesc}}{{end}}
            </div>
        </details>
    </div>
    {{end}} {{$excludes := slice "event_type" "actor_login" "repo_name"
    "repo_url" "repo_desc" "language" "stars" "forks" "public" "ref" "size"
    "action" "issue_number" "issue_title" "issue_url" "pr_number" "pr_title"
    "pr_url" "title" "link" "url" "html_url" "description" "summary" "body"
    "source" "dstype" "payload"}} {{$filteredMetadata := filterMetadata
    .Metadata $excludes}} {{$payload := index .Metadata "payload"}} {{if or
    $filteredMetadata $payload}}
    <div class="cb-extras">
        <details class="cb-details">
            <summary>Show additional data</summary>
            <div class="cb-extras-content">
                {{if $filteredMetadata}}
                <dl class="cb-metadata">
                    {{range $key, $value := $filteredMetadata}}
                    <dt>{{$key}}</dt>
                    <dd>{{$value}}</dd>
                    {{end}}
                </dl>
                {{end}} {{if $payload}}
                <div class="cb-payload">
                    <strong>Event Payload:</strong>
                    <pre><code>{{$payload}}</code></pre>
                </div>
                {{end}}
            </div>
        </details>
    </div>
    {{end}}
</div>

<style>
    .block-codeberg {
        margin-bottom: 1.5rem;
        padding: 0;
        border: 1px solid var(--border);
        border-radius: 4px;
        background: var(--surface);
        font-family:
            -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
            "Helvetica Neue", Arial, sans-serif;
        font-size: 13px;
        line-height: 1.3;
        transition:
            background 0.25s ease,
            border-color 0.25s ease;
    }

    .cb-header {
        display: flex;
        gap: 8px;
        padding: 6px 8px;
        background: var(--surface-alt);
        transition: background 0.25s ease;
    }

    .cb-stats {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 35px;
        padding-top: 2px;
    }

    .cb-stats .stat-score {
        font-size: 12px;
        font-weight: bold;
        color: var(--text);
        line-height: 1;
    }

    .cb-stats .stat-label {
        font-size: 8px;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        line-height: 1;
        margin-top: 1px;
    }

    .cb-stats .stat-placeholder {
        color: var(--border);
        font-size: 14px;
        margin-top: 4px;
    }

    .cb-content {
        flex: 1;
        min-width: 0;
    }

    .cb-title {
        margin-bottom: 4px;
        line-height: 1.2;
        font-size: 14px;
        color: var(--text);
        word-wrap: break-word;
        overflow-wrap: break-word;
    }

    .cb-repo-link {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
    }

    .cb-repo-link:hover {
        text-decoration: underline;
    }

    .cb-repo-name {
        color: var(--text);
        font-weight: 600;
    }

    .cb-language {
        color: var(--text-dim);
        font-size: 12px;
        font-weight: normal;
    }

    .cb-event-details {
        margin: 2px 0 4px 0;
        font-size: 12px;
        color: var(--text-dim);
        line-height: 1.3;
    }

    .cb-ref {
        background: var(--bg-alt);
        padding: 1px 4px;
        border-radius: 3px;
        font-family: monospace;
        font-size: 11px;
        color: var(--text);
    }

    .cb-action {
        padding: 1px 4px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: 500;
        text-transform: lowercase;
    }

    .cb-action-opened {
        background: var(--success);
        color: var(--text);
    }

    .cb-action-closed {
        background: var(--error);
        color: var(--text);
    }

    .cb-action-merged {
        background: var(--accent-alt);
        color: var(--text);
    }

    .cb-issue-link,
    .cb-pr-link {
        color: var(--accent);
        text-decoration: none;
        margin-left: 4px;
    }

    .cb-issue-link:hover,
    .cb-pr-link:hover {
        text-decoration: underline;
    }

    .cb-issue-ref,
    .cb-pr-ref {
        color: var(--text);
        margin-left: 4px;
    }

    .cb-meta {
        color: var(--text-dim);
        font-size: 11px;
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
    }

    .cb-time {
        font-variant-numeric: tabular-nums;
    }

    .cb-separator {
        color: var(--border);
        margin: 0 2px;
    }

    .cb-forks,
    .cb-visibility {
        font-weight: normal;
    }

    .cb-view {
        color: var(--text-dim);
        text-decoration: none;
    }

    .cb-view:hover {
        text-decoration: underline;
        color: var(--text);
    }

    .cb-description,
    .cb-extras {
        background: var(--surface-alt);
        padding: 8px;
        border-top: 1px solid var(--border);
        transition:
            background 0.25s ease,
            border-color 0.25s ease;
    }

    .cb-details {
        font-size: 12px;
    }

    .cb-details summary {
        color: var(--text-dim);
        cursor: pointer;
        padding: 4px 0;
        font-weight: normal;
        transition: color 0.25s ease;
    }

    .cb-details summary:hover {
        color: var(--text);
    }

    .cb-details[open] summary {
        margin-bottom: 8px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 8px;
    }

    .cb-description-content,
    .cb-extras-content {
        background: var(--surface);
        padding: 12px;
        border: 1px solid var(--border);
        border-radius: 2px;
        color: var(--text);
        font-size: 13px;
        line-height: 1.4;
        transition:
            background 0.25s ease,
            border-color 0.25s ease,
            color 0.25s ease;
    }

    .cb-metadata {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 4px 12px;
        margin: 0 0 12px 0;
    }

    .cb-metadata dt {
        font-weight: 500;
        color: var(--text-dim);
        font-size: 12px;
    }

    .cb-metadata dd {
        margin: 0;
        color: var(--text);
        word-break: break-word;
        font-size: 12px;
    }

    .cb-payload {
        border-top: 1px solid var(--border);
        padding-top: 12px;
    }

    .cb-payload pre {
        margin: 8px 0 0 0;
        background: var(--surface-alt);
        padding: 8px;
        border: 1px solid var(--border);
        border-radius: 3px;
        font-size: 11px;
        line-height: 1.3;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 200px;
        overflow-y: auto;
        color: var(--text);
    }

    .cb-payload code {
        color: var(--text);
        font-family:
            "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
        .cb-header {
            padding: 8px 6px;
        }

        .cb-stats {
            min-width: 30px;
        }

        .cb-meta {
            font-size: 10px;
        }

        .cb-language {
            display: none;
        }
    }

    /* Codeberg-style hover states */
    .cb-header:hover {
        background: var(--surface-alt);
    }
</style>
